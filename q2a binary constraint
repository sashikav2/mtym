def matrixsearch_general(x, y):
    """
    Greedy + cyclic algorithm to find binary square matrix A such that A*x = y
    Each row i is a subset sum of x equal to y[i]. Supports negative numbers.
    """
    n = len(x)

    # Check that y has the same length as x
    if len(y) != n:
        print(f"Erreur: impossible de construire une matrice carrée car len(x) != len(y) ({n} != {len(y)})")
        return None

    A = [[0]*n for _ in range(n)]

    # Indices sorted by descending absolute value
    indices = sorted(range(n), key=lambda j: -abs(x[j]))

    for i in range(n):
        target = y[i]

        # --- Special case: target = 0 ---
        if target == 0:
            A[i] = [0]*n
            continue

        found = False

        # Try each element as the forced first choice (cyclic)
        for first in range(n):
            row = [0]*n
            remaining = target

            # Force first choice
            row[first] = 1
            remaining -= x[first]

            # Immediate success
            if remaining == 0:
                A[i] = row
                found = True
                break

            unused = set(indices)
            unused.remove(first)

            # Greedy completion minimizing abs(remaining)
            while remaining != 0 and unused:
                j = min(unused, key=lambda idx: abs(remaining - x[idx]))
                row[j] = 1
                remaining -= x[j]
                unused.remove(j)

            if remaining == 0:
                A[i] = row
                found = True
                break  # row completed successfully

        if not found:
            print(f"Impossible d'atteindre y[{i}] = {target}")
            return None

    return A


def verify_solution(A, x, y):
    if A is None:
        return False
    n = len(x)
    return all(
        sum(A[i][j]*x[j] for j in range(n)) == y[i]
        for i in range(n)
    )


# ================= MAIN PROGRAM =================

try:
    print("Entrez les éléments du vecteur x séparés par des espaces:")
    x = list(map(int, input().split()))

    print("Entrez les éléments du vecteur y séparés par des espaces:")
    y = list(map(int, input().split()))

    A = matrixsearch_general(x, y)

    if A is not None:
        print("\nMatrice A:")
        for row in A:
            print(row)

        print("\nVérification:", verify_solution(A, x, y))
    else:
        print("Impossible de construire la matrice.")

except ValueError:
    print("Erreur: Veuillez entrer uniquement des nombres!")
